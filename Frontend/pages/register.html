<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Register - Sekai</title>

  <!-- Favicons -->
  <link href="../assets/img/sekai.png" rel="icon">
  <link href="../assets/img/sekai.png" rel="apple-touch-icon">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">

  <!-- jQuery -->
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Custom CSS -->
  <style>
    /* Base Styles */
    html, body {
      height: 100%;
      margin: 0;
      padding: 0;
      overflow-x: hidden;
      font-family: 'Poppins', sans-serif !important;
    }

    body {
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%) !important;
      min-height: 100vh !important;
      padding: 100px 20px 20px 20px !important; /* Increased top padding to ensure title visibility */
      position: relative !important; /* For absolute positioning of the title */
      display: flex !important; /* Keep flex for centering the form */
      align-items: center !important;
      justify-content: center !important;
    }

    /* Register Container */
    .register-container {
      background: #ffffff !important;
      border-radius: 20px !important;
      box-shadow: 0 15px 40px rgba(0, 0, 0, 0.1) !important;
      padding: 40px !important;
      width: 100% !important;
      max-width: 450px !important;
      position: relative !important;
      overflow: hidden !important;
      margin: 0 auto !important;
      z-index: 1 !important; /* Ensure the form is below the title */
    }

    .register-container::before {
      content: '';
      position: absolute !important;
      top: 0 !important;
      left: 0 !important;
      width: 100% !important;
      height: 5px !important;
      background: #5fcf80 !important; /* Green top border */
    }

    .register-container h2 {
      color: #2c3e50 !important;
      font-weight: 700 !important;
      font-size: 28px !important;
      margin-bottom: 30px !important;
      text-align: center !important;
    }

    /* Success Message */
    .success-message {
      text-align: center !important;
    }

    .success-message h3 {
      color: #2d862d !important;
      font-size: 24px !important;
      margin-bottom: 20px !important;
    }

    .success-message p {
      color: #7f8c8d !important;
      font-size: 16px !important;
      margin-bottom: 20px !important;
    }

    .success-message a {
      color: #5fcf80 !important;
      font-weight: 600 !important;
      text-decoration: none !important;
      transition: color 0.3s ease !important;
    }

    .success-message a:hover {
      color: #4db369 !important;
    }

    /* Form Elements */
    .register-container .mb-3 {
      position: relative !important;
      margin-bottom: 25px !important; /* Consistent spacing between fields */
    }

    .register-container .form-control {
      background: #f8f9fa !important; /* Light gray background */
      border: 2px solid #dfe6e9 !important; /* Border color */
      border-radius: 10px !important;
      height: 50px !important;
      padding: 10px 15px !important; /* Removed extra right padding since icon is gone */
      font-size: 16px !important;
      transition: all 0.3s ease !important;
      width: 100% !important;
      box-shadow: none !important;
    }

    .register-container .form-control:focus {
      border-color: #5fcf80 !important;
      background: #ffffff !important;
      box-shadow: 0 0 8px rgba(95, 207, 128, 0.3) !important;
      outline: none !important;
    }

    .register-container .form-control.is-invalid {
      border-color: #dc3545 !important;
    }

    .register-container .invalid-feedback {
      font-size: 12px !important;
      color: #dc3545 !important;
      margin-top: 5px !important;
    }

    /* Show Password Checkbox */
    .show-password {
      display: flex !important;
      align-items: center !important;
      margin-top: 5px !important;
      margin-bottom: 10px !important;
    }

    .show-password input[type="checkbox"] {
      margin-right: 8px !important;
      accent-color: #5fcf80 !important; /* Green checkbox color */
      width: 16px !important;
      height: 16px !important;
    }

    .show-password label {
      color: #7f8c8d !important;
      font-size: 14px !important;
      cursor: pointer !important;
      user-select: none !important;
    }

    .register-container .btn-register {
      background: #5fcf80 !important;
      border: none !important;
      padding: 12px !important;
      font-size: 16px !important;
      font-weight: 600 !important;
      border-radius: 10px !important;
      color: #fff !important;
      transition: all 0.3s ease !important;
      width: 100% !important;
      box-shadow: none !important;
    }

    .register-container .btn-register:hover {
      background: #4db369 !important;
      transform: translateY(-2px) !important;
      box-shadow: 0 5px 15px rgba(95, 207, 128, 0.4) !important;
    }

    /* Links */
    .register-container .text-center.mt-3 {
      margin-top: 20px !important;
      text-align: center !important;
    }

    .register-container .text-center.mt-3 p {
      color: #7f8c8d !important;
      font-size: 14px !important;
      margin: 0 !important;
    }

    .register-container .text-center.mt-3 a {
      color: #5fcf80 !important;
      font-weight: 600 !important;
      text-decoration: none !important;
      transition: color 0.3s ease !important;
    }

    .register-container .text-center.mt-3 a:hover {
      color: #4db369 !important;
    }

    /* Alerts */
    .register-container .alert {
      padding: 12px !important;
      margin-bottom: 20px !important;
      border-radius: 8px !important;
      font-size: 14px !important;
      display: none;
      transition: opacity 0.3s ease !important;
      width: 100% !important;
    }

    .register-container .alert-success {
      background-color: #e6f9e6 !important;
      color: #2d862d !important;
      border: 1px solid #b3e6b3 !important;
    }

    .register-container .alert-danger {
      background-color: #fce8e8 !important;
      color: #a94442 !important;
      border: 1px solid #f4c7c7 !important;
    }

    /* Responsive Design */
    @media (max-width: 768px) {
      body {
        padding: 80px 15px 15px 15px !important; /* Adjusted top padding */
      }

      .page-title {
        font-size: 40px !important; /* Smaller title on tablets */
        top: 15px !important;
        letter-spacing: 6px !important;
        padding: 8px 16px !important;
      }

      .register-container {
        padding: 30px !important;
        max-width: 100% !important;
      }

      .register-container h2 {
        font-size: 24px !important;
        margin-bottom: 20px !important;
      }

      .register-container .form-control {
        height: 45px !important;
        font-size: 14px !important;
        padding: 8px 12px !important;
      }

      .show-password label {
        font-size: 13px !important;
      }

      .show-password input[type="checkbox"] {
        width: 14px !important;
        height: 14px !important;
      }

      .register-container .btn-register {
        padding: 10px !important;
        font-size: 14px !important;
      }

      .register-container .text-center.mt-3 p,
      .register-container .text-center.mt-3 a {
        font-size: 13px !important;
      }

      .register-container .alert {
        font-size: 13px !important;
        padding: 10px !important;
        margin-bottom: 15px !important;
      }

      .register-container .invalid-feedback {
        font-size: 11px !important;
      }

      .success-message h3 {
        font-size: 20px !important;
      }

      .success-message p {
        font-size: 14px !important;
      }
    }

    @media (max-width: 576px) {
      body {
        padding: 70px 10px 10px 10px !important; /* Adjusted top padding */
      }

      .page-title {
        font-size: 32px !important; /* Even smaller title on mobile */
        top: 10px !important;
        letter-spacing: 4px !important;
        padding: 6px 12px !important;
        border-bottom: 2px solid #4db369 !important;
      }

      .register-container {
        padding: 20px !important;
      }

      .register-container h2 {
        font-size: 20px !important;
      }

      .register-container .form-control {
        height: 40px !important;
        font-size: 13px !important;
        padding: 8px 10px !important;
      }

      .show-password label {
        font-size: 12px !important;
      }

      .show-password input[type="checkbox"] {
        width: 12px !important;
        height: 12px !important;
      }

      .register-container .btn-register {
        padding: 8px !important;
        font-size: 13px !important;
      }

      .register-container .text-center.mt-3 p,
      .register-container .text-center.mt-3 a {
        font-size: 12px !important;
      }

      .register-container .alert {
        font-size: 12px !important;
        padding: 8px !important;
      }

      .register-container .invalid-feedback {
        font-size: 10px !important;
      }

      .success-message h3 {
        font-size: 18px !important;
      }

      .success-message p {
        font-size: 13px !important;
      }
    }
  </style>
</head>
<body>
<div class="register-container">
  <h2 class="text-center mb-4">Create New Account</h2>

  <div id="alertSuccess" class="alert alert-success"></div>
  <div id="alertError" class="alert alert-danger"></div>

  <div id="registrationFormContainer">
    <form id="registrationForm" novalidate>
      <div class="mb-3">
        <input type="text" class="form-control" id="name" name="name" placeholder="Your Name" required>
        <div class="invalid-feedback" id="nameError"></div>
      </div>

      <div class="mb-3">
        <input type="email" class="form-control" id="email" name="email" placeholder="Your Email" required>
        <div class="invalid-feedback" id="emailError"></div>
      </div>

      <div class="mb-3">
        <input type="text" class="form-control" id="phone" name="phoneNumber" placeholder="Phone Number" required>
        <div class="invalid-feedback" id="phoneError"></div>
      </div>

      <div class="mb-3">
        <input type="password" class="form-control" id="password" name="password" placeholder="Create Password" required>
        <div class="invalid-feedback" id="passwordError"></div>
        <div class="show-password">
          <input type="checkbox" id="showPassword">
          <label for="showPassword">Show Password</label>
        </div>
      </div>

      <div class="mb-3">
        <input type="password" class="form-control" id="confirmPassword" name="confirm-password" placeholder="Confirm Password" required>
        <div class="invalid-feedback" id="confirmPasswordError"></div>
        <div class="show-password">
          <input type="checkbox" id="showConfirmPassword">
          <label for="showConfirmPassword">Show Password</label>
        </div>
      </div>

      <button type="submit" class="btn btn-register">Register</button>
    </form>

    <div class="text-center mt-3">
      <p>Already have an account? <a href="login.html">Login here</a></p>
    </div>
  </div>

  <div id="successMessage" class="success-message" style="display: none;">
    <h3>Registration Successful!</h3>
    <p>Your account has been created successfully.</p>
    <p><a href="login.html">Proceed to Login</a></p>
  </div>
</div>

<script>
  $(document).ready(function() {
    // Validation functions
    const validateName = (name) => {
      const nameRegex = /^[A-Za-z\s]+$/;
      if (!name) return "Name is required.";
      if (!nameRegex.test(name)) return "Name should contain only letters and spaces.";
      return "";
    };

    const validateEmail = (email) => {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!email) return "Email is required.";
      if (!emailRegex.test(email)) return "Please enter a valid email address.";
      return "";
    };

    const validatePhone = (phone) => {
      const phoneRegex = /^\d{10}$/; // Simple 10-digit phone number validation
      if (!phone) return "Phone number is required.";
      if (!phoneRegex.test(phone)) return "Please enter a valid 10-digit phone number.";
      return "";
    };

    const validatePassword = (password) => {
      const passwordRegex = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[@$!%*?&])[A-Za-z\d@$!%*?&]{8,}$/;
      if (!password) return "Password is required.";
      if (!passwordRegex.test(password)) return "Password must be at least 8 characters long, with at least one uppercase letter, one lowercase letter, one number, and one special character.";
      return "";
    };

    const validateConfirmPassword = (password, confirmPassword) => {
      if (!confirmPassword) return "Confirm password is required.";
      if (password !== confirmPassword) return "Passwords do not match.";
      return "";
    };

    // Toggle password visibility with checkbox
    $('#showPassword').on('change', function() {
      const passwordField = $('#password');
      const type = this.checked ? 'text' : 'password';
      passwordField.attr('type', type);
    });

    $('#showConfirmPassword').on('change', function() {
      const confirmPasswordField = $('#confirmPassword');
      const type = this.checked ? 'text' : 'password';
      confirmPasswordField.attr('type', type);
    });

    // Form submission handler
    $('#registrationForm').on('submit', function(e) {
      e.preventDefault();

      // Clear previous alerts and errors
      $('#alertSuccess, #alertError').hide();
      $('.form-control').removeClass('is-invalid');
      $('.invalid-feedback').text('');

      // Get form values
      const name = $('#name').val().trim();
      const email = $('#email').val().trim();
      const phone = $('#phone').val().trim();
      const password = $('#password').val();
      const confirmPassword = $('#confirmPassword').val();

      // Validate inputs
      let isValid = true;

      // Validate Name
      const nameError = validateName(name);
      if (nameError) {
        $('#name').addClass('is-invalid');
        $('#nameError').text(nameError);
        isValid = false;
      }

      // Validate Email
      const emailError = validateEmail(email);
      if (emailError) {
        $('#email').addClass('is-invalid');
        $('#emailError').text(emailError);
        isValid = false;
      }

      // Validate Phone
      const phoneError = validatePhone(phone);
      if (phoneError) {
        $('#phone').addClass('is-invalid');
        $('#phoneError').text(phoneError);
        isValid = false;
      }

      // Validate Password
      const passwordError = validatePassword(password);
      if (passwordError) {
        $('#password').addClass('is-invalid');
        $('#passwordError').text(passwordError);
        isValid = false;
      }

      // Validate Confirm Password
      const confirmPasswordError = validateConfirmPassword(password, confirmPassword);
      if (confirmPasswordError) {
        $('#confirmPassword').addClass('is-invalid');
        $('#confirmPasswordError').text(confirmPasswordError);
        isValid = false;
      }

      // If validation fails, stop here
      if (!isValid) {
        $('#alertError').text('Please fix the errors in the form.').show();
        return;
      }

      // Prepare data for API
      const userData = {
        name: name,
        email: email,
        phoneNumber: phone,
        password: password
      };

      // Make AJAX call to register endpoint
      $.ajax({
        url: 'http://localhost:8080/api/v1/auth/register',
        type: 'POST',
        contentType: 'application/json',
        data: JSON.stringify(userData),
        success: function(response) {
          // Check for success status
          if (response.statusCode === 200 || response.statusCode === 201) {
            // Hide the form and show the success message
            $('#registrationFormContainer').hide();
            $('#successMessage').show();
            $('.form-control').removeClass('is-invalid');
            $('.invalid-feedback').text('');
          } else {
            $('#alertError').text(response.message || 'Registration failed. Please try again.').show();
          }
        },
        error: function(xhr) {
          let errorMessage = 'Registration failed. Please try again.';
          try {
            const response = JSON.parse(xhr.responseText);
            if (xhr.status === 400) {
              // Bad request (e.g., invalid input)
              errorMessage = response.message || 'Invalid input. Please check your details.';
            } else if (xhr.status === 409) {
              // Conflict (e.g., email already exists)
              errorMessage = response.message || 'Email already exists. Please use a different email.';
            } else if (xhr.status === 500) {
              // Server error
              errorMessage = 'Server error. Please try again later.';
            }
          } catch(e) {
            console.error('Error parsing response:', e);
          }
          $('#alertError').text(errorMessage).show();
        }
      });
    });

    // Real-time validation on input change
    $('#name').on('input', function() {
      const name = $(this).val().trim();
      const error = validateName(name);
      if (error) {
        $(this).addClass('is-invalid');
        $('#nameError').text(error);
      } else {
        $(this).removeClass('is-invalid');
        $('#nameError').text('');
      }
    });

    $('#email').on('input', function() {
      const email = $(this).val().trim();
      const error = validateEmail(email);
      if (error) {
        $(this).addClass('is-invalid');
        $('#emailError').text(error);
      } else {
        $(this).removeClass('is-invalid');
        $('#emailError').text('');
      }
    });

    $('#phone').on('input', function() {
      const phone = $(this).val().trim();
      const error = validatePhone(phone);
      if (error) {
        $(this).addClass('is-invalid');
        $('#phoneError').text(error);
      } else {
        $(this).removeClass('is-invalid');
        $('#phoneError').text('');
      }
    });

    $('#password').on('input', function() {
      const password = $(this).val();
      const error = validatePassword(password);
      if (error) {
        $('#password').addClass('is-invalid');
        $('#passwordError').text(error);
      } else {
        $('#password').removeClass('is-invalid');
        $('#passwordError').text('');
      }
      // Re-validate confirm password if password changes
      const confirmPassword = $('#confirmPassword').val();
      if (confirmPassword) {
        const confirmError = validateConfirmPassword(password, confirmPassword);
        if (confirmError) {
          $('#confirmPassword').addClass('is-invalid');
          $('#confirmPasswordError').text(confirmError);
        } else {
          $('#confirmPassword').removeClass('is-invalid');
          $('#confirmPasswordError').text('');
        }
      }
    });

    $('#confirmPassword').on('input', function() {
      const password = $('#password').val();
      const confirmPassword = $(this).val();
      const error = validateConfirmPassword(password, confirmPassword);
      if (error) {
        $(this).addClass('is-invalid');
        $('#confirmPasswordError').text(error);
      } else {
        $(this).removeClass('is-invalid');
        $('#confirmPasswordError').text('');
      }
    });
  });
</script>
</body>
</html>